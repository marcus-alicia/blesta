/**
 * Copyright (c) 2008 Kelvin Luck (http://www.kelvinluck.com/)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) 
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 **/
!function(e){e.fn.extend({renderCalendar:function(t){var a=function(e){return document.createElement(e)};if((t=e.extend({},e.fn.datePicker.defaults,t)).showHeader!=e.dpConst.SHOW_HEADER_NONE)for(var s=e(a("tr")),i=Date.firstDayOfWeek;i<Date.firstDayOfWeek+7;i++){var n=i%7,l=Date.dayNames[n];s.append(jQuery(a("th")).attr({scope:"col",abbr:l,title:l,class:0==n||6==n?"weekend":"weekday"}).html(t.showHeader==e.dpConst.SHOW_HEADER_SHORT?Date.abbrDayNames[n]:l))}var d=e(a("table")).attr({cellspacing:0}).addClass("jCalendar").append(t.showHeader!=e.dpConst.SHOW_HEADER_NONE?e(a("thead")).append(s):a("thead")),r=e(a("tbody")),o=(new Date).zeroTime();o.setHours(12);var h=null==t.month?o.getMonth():t.month,c=t.year||o.getFullYear(),p=new Date(c,h,1,12,0,0),u=Date.firstDayOfWeek-p.getDay()+1;u>1&&(u-=7);var f=Math.ceil((-1*u+1+p.getDaysInMonth())/7);p.addDays(u-1);for(var v=function(a){return function(){if(t.hoverClass){var s=e(this);t.selectWeek?a&&!s.is(".disabled")&&s.parent().addClass("activeWeekHover"):s.addClass(t.hoverClass)}}},D=function(){if(t.hoverClass){var a=e(this);a.removeClass(t.hoverClass),a.parent().removeClass("activeWeekHover")}},m=0;m++<f;){var C=jQuery(a("tr")),y=!!t.dpController&&p>t.dpController.startDate;for(i=0;i<7;i++){var g=p.getMonth()==h,b=e(a("td")).text(p.getDate()+"").addClass((g?"current-month ":"other-month ")+(p.isWeekend()?"weekend ":"weekday ")+(g&&p.getTime()==o.getTime()?"today ":"")).data("datePickerDate",p.asString()).hover(v(y),D);C.append(b),t.renderCallback&&t.renderCallback(b,p,h,c),p=new Date(p.getFullYear(),p.getMonth(),p.getDate()+1,12,0,0)}r.append(C)}return d.append(r),this.each(function(){e(this).empty().append(d)})},datePicker:function(t){return e.event._dpCache||(e.event._dpCache=[]),t=e.extend({},e.fn.datePicker.defaults,t),this.each(function(){var s=e(this),i=!0;this._dpId||(this._dpId=e.guid++,e.event._dpCache[this._dpId]=new a(this),i=!1),t.inline&&(t.createButton=!1,t.displayClose=!1,t.closeOnSelect=!1,s.empty());var n=e.event._dpCache[this._dpId];if(n.init(t),!i&&t.createButton&&(n.button=e('<a href="#" class="dp-choose-date" title="'+e.dpText.TEXT_CHOOSE_DATE+'">'+e.dpText.TEXT_CHOOSE_DATE+"</a>").bind("click",function(){return s.dpDisplay(this),this.blur(),!1}),s.after(n.button)),!i&&s.is(":text")){s.bind("dateSelected",function(e,t,a){this.value=t.asString()}).bind("change",function(){if(""==this.value)n.clearSelected();else{var e=Date.fromString(this.value);e&&n.setSelected(e,!0,!0)}}),t.clickInput&&s.bind("click",function(){s.trigger("change"),s.dpDisplay()});var l=Date.fromString(this.value);""!=this.value&&l&&n.setSelected(l,!0,!0)}s.addClass("dp-applied")})},dpSetDisabled:function(e){return t.call(this,"setDisabled",e)},dpSetStartDate:function(e){return t.call(this,"setStartDate",e)},dpSetEndDate:function(e){return t.call(this,"setEndDate",e)},dpGetSelected:function(){var e=s(this[0]);return e?e.getSelected():null},dpSetSelected:function(e,a,s,i){return null==a&&(a=!0),null==s&&(s=!0),null==i&&(i=!0),t.call(this,"setSelected",Date.fromString(e),a,s,i)},dpSetDisplayedMonth:function(e,a){return t.call(this,"setDisplayedMonth",Number(e),Number(a),!0)},dpDisplay:function(e){return t.call(this,"display",e)},dpSetRenderCallback:function(e){return t.call(this,"setRenderCallback",e)},dpSetPosition:function(e,a){return t.call(this,"setPosition",e,a)},dpSetOffset:function(e,a){return t.call(this,"setOffset",e,a)},dpClose:function(){return t.call(this,"_closeCalendar",!1,this[0])},dpRerenderCalendar:function(){return t.call(this,"_rerenderCalendar")},_dpDestroy:function(){}});var t=function(e,t,a,i,n){return this.each(function(){var l=s(this);l&&l[e](t,a,i,n)})};function a(e){this.ele=e,this.displayedMonth=null,this.displayedYear=null,this.startDate=null,this.endDate=null,this.showYearNavigation=null,this.closeOnSelect=null,this.displayClose=null,this.rememberViewedMonth=null,this.selectMultiple=null,this.numSelectable=null,this.numSelected=null,this.verticalPosition=null,this.horizontalPosition=null,this.verticalOffset=null,this.horizontalOffset=null,this.button=null,this.renderCallback=[],this.selectedDates={},this.inline=null,this.context="#dp-popup",this.settings={}}function s(t){return!!t._dpId&&e.event._dpCache[t._dpId]}e.extend(a.prototype,{init:function(e){this.setStartDate(e.startDate),this.setEndDate(e.endDate),this.setDisplayedMonth(Number(e.month),Number(e.year)),this.setRenderCallback(e.renderCallback),this.showYearNavigation=e.showYearNavigation,this.closeOnSelect=e.closeOnSelect,this.displayClose=e.displayClose,this.rememberViewedMonth=e.rememberViewedMonth,this.selectMultiple=e.selectMultiple,this.numSelectable=e.selectMultiple?e.numSelectable:1,this.numSelected=0,this.verticalPosition=e.verticalPosition,this.horizontalPosition=e.horizontalPosition,this.hoverClass=e.hoverClass,this.setOffset(e.verticalOffset,e.horizontalOffset),this.inline=e.inline,this.settings=e,this.inline&&(this.context=this.ele,this.display())},setStartDate:function(e){e&&(e instanceof Date?this.startDate=e:this.startDate=Date.fromString(e)),this.startDate||(this.startDate=(new Date).zeroTime()),this.setDisplayedMonth(this.displayedMonth,this.displayedYear)},setEndDate:function(e){e&&(e instanceof Date?this.endDate=e:this.endDate=Date.fromString(e)),this.endDate||(this.endDate=new Date("12/31/2999")),this.endDate.getTime()<this.startDate.getTime()&&(this.endDate=this.startDate),this.setDisplayedMonth(this.displayedMonth,this.displayedYear)},setPosition:function(e,t){this.verticalPosition=e,this.horizontalPosition=t},setOffset:function(e,t){this.verticalOffset=parseInt(e)||0,this.horizontalOffset=parseInt(t)||0},setDisabled:function(t){$e=e(this.ele),$e[t?"addClass":"removeClass"]("dp-disabled"),this.button&&($but=e(this.button),$but[t?"addClass":"removeClass"]("dp-disabled"),$but.attr("title",t?"":e.dpText.TEXT_CHOOSE_DATE)),$e.is(":text")&&$e.prop("disabled",t)},setDisplayedMonth:function(t,a,s){if(null!=this.startDate&&null!=this.endDate){var i=new Date(this.startDate.getTime());i.setDate(1);var n,l=new Date(this.endDate.getTime());l.setDate(1),!t&&!a||isNaN(t)&&isNaN(a)?(n=(new Date).zeroTime()).setDate(1):n=isNaN(t)?new Date(a,this.displayedMonth,1):isNaN(a)?new Date(this.displayedYear,t,1):new Date(a,t,1),n.getTime()<i.getTime()?n=i:n.getTime()>l.getTime()&&(n=l);var d=this.displayedMonth,r=this.displayedYear;this.displayedMonth=n.getMonth(),this.displayedYear=n.getFullYear(),!s||this.displayedMonth==d&&this.displayedYear==r||(this._rerenderCalendar(),e(this.ele).trigger("dpMonthChanged",[this.displayedMonth,this.displayedYear]))}},setSelected:function(t,a,s,i){if(!(t<this.startDate||t.zeroTime()>this.endDate.zeroTime())&&(!((d=this.settings).selectWeek&&(t=t.addDays(-(t.getDay()-Date.firstDayOfWeek+7)%7))<this.startDate)&&a!=this.isSelected(t))){if(0==this.selectMultiple)this.clearSelected();else if(a&&this.numSelected==this.numSelectable)return;!s||this.displayedMonth==t.getMonth()&&this.displayedYear==t.getFullYear()||this.setDisplayedMonth(t.getMonth(),t.getFullYear(),!0),this.selectedDates[t.asString()]=a,this.numSelected+=a?1:-1;var n,l="td."+(t.getMonth()==this.displayedMonth?"current-month":"other-month");if(e(l,this.context).each(function(){e(this).data("datePickerDate")==t.asString()&&(n=e(this),d.selectWeek&&n.parent()[a?"addClass":"removeClass"]("selectedWeek"),n[a?"addClass":"removeClass"]("selected"))}),e("td",this.context).not(".selected")[this.selectMultiple&&this.numSelected==this.numSelectable?"addClass":"removeClass"]("unselectable"),i){var d=this.isSelected(t);$e=e(this.ele);var r=Date.fromString(t.asString());$e.trigger("dateSelected",[r,n,d]),$e.trigger("change")}}},isSelected:function(e){return this.selectedDates[e.asString()]},getSelected:function(){var e=[];for(var t in this.selectedDates)1==this.selectedDates[t]&&e.push(Date.fromString(t));return e},clearSelected:function(){this.selectedDates={},this.numSelected=0,e("td.selected",this.context).removeClass("selected").parent().removeClass("selectedWeek")},display:function(t){if(!e(this.ele).is(".dp-disabled")){t=t||this.ele;var a,s,i,n=this,l=e(t),d=l.offset();if(n.inline)a=e(this.ele),s={id:"calendar-"+this.ele._dpId,class:"dp-popup dp-popup-inline"},e(".dp-popup",a).remove(),i={};else{a=e("body"),s={id:"dp-popup",class:"dp-popup"},i={top:d.top+n.verticalOffset,left:d.left+n.horizontalOffset};this._checkMouse=function(t){for(var a=t.target,s=e("#dp-popup")[0];;){if(a==s)return!0;if(a==document)return n._closeCalendar(),!1;a=e(a).parent()[0]}},n._closeCalendar(!0),e(document).bind("keydown.datepicker",function(e){27==e.keyCode&&n._closeCalendar()})}if(!n.rememberViewedMonth){var r=this.getSelected()[0];r&&(r=new Date(r),this.setDisplayedMonth(r.getMonth(),r.getFullYear(),!1))}a.append(e("<div></div>").attr(s).css(i).append(e("<h2></h2>"),e('<div class="dp-nav-prev"></div>').append(e('<a class="dp-nav-prev-year" href="#" title="'+e.dpText.TEXT_PREV_YEAR+'">&laquo;</a>').bind("click",function(){return n._displayNewMonth.call(n,this,0,-1)}),e('<a class="dp-nav-prev-month" href="#" title="'+e.dpText.TEXT_PREV_MONTH+'">&lsaquo;</a>').bind("click",function(){return n._displayNewMonth.call(n,this,-1,0)})),e('<div class="dp-nav-next"></div>').append(e('<a class="dp-nav-next-year" href="#" title="'+e.dpText.TEXT_NEXT_YEAR+'">&raquo;</a>').bind("click",function(){return n._displayNewMonth.call(n,this,0,1)}),e('<a class="dp-nav-next-month" href="#" title="'+e.dpText.TEXT_NEXT_MONTH+'">&rsaquo;</a>').bind("click",function(){return n._displayNewMonth.call(n,this,1,0)})),e('<div class="dp-calendar"></div>')).bgIframe());var o=this.inline?e(".dp-popup",this.context):e("#dp-popup");0==this.showYearNavigation&&e(".dp-nav-prev-year, .dp-nav-next-year",n.context).css("display","none"),this.displayClose&&o.append(e('<a href="#" id="dp-close">'+e.dpText.TEXT_CLOSE+"</a>").bind("click",function(){return n._closeCalendar(),!1})),n._renderCalendar(),e(this.ele).trigger("dpDisplayed",o),n.inline||(this.verticalPosition==e.dpConst.POS_BOTTOM&&o.css("top",d.top+l.height()-o.height()+n.verticalOffset),this.horizontalPosition==e.dpConst.POS_RIGHT&&o.css("left",d.left+l.width()-o.width()+n.horizontalOffset),e(document).bind("mousedown.datepicker",this._checkMouse))}},setRenderCallback:function(e){null!=e&&(e&&"function"==typeof e&&(e=[e]),this.renderCallback=this.renderCallback.concat(e))},cellRender:function(t,a,s,i){var n=this.dpController,l=new Date(a.getTime());t.bind("click",function(){var t=e(this);if(!t.is(".disabled")&&(n.setSelected(l,!t.is(".selected")||!n.selectMultiple,!1,!0),n.closeOnSelect)){if(n.settings.autoFocusNextInput){var a=n.ele,s=!1;e(":input",a.form).each(function(){if(s)return e(this).focus(),!1;this==a&&(s=!0)})}else try{n.ele.focus()}catch(e){}n._closeCalendar()}}),n.isSelected(l)?(t.addClass("selected"),n.settings.selectWeek&&t.parent().addClass("selectedWeek")):n.selectMultiple&&n.numSelected==n.numSelectable&&t.addClass("unselectable")},_applyRenderCallbacks:function(){var t=this;e("td",this.context).each(function(){for(var a=0;a<t.renderCallback.length;a++)$td=e(this),t.renderCallback[a].apply(this,[$td,Date.fromString($td.data("datePickerDate")),t.displayedMonth,t.displayedYear])})},_displayNewMonth:function(t,a,s){return e(t).is(".disabled")||this.setDisplayedMonth(this.displayedMonth+a,this.displayedYear+s,!0),t.blur(),!1},_rerenderCalendar:function(){this._clearCalendar(),this._renderCalendar()},_renderCalendar:function(){if(e("h2",this.context).html(new Date(this.displayedYear,this.displayedMonth,1).asString(e.dpText.HEADER_FORMAT)),e(".dp-calendar",this.context).renderCalendar(e.extend({},this.settings,{month:this.displayedMonth,year:this.displayedYear,renderCallback:this.cellRender,dpController:this,hoverClass:this.hoverClass})),this.displayedYear==this.startDate.getFullYear()&&this.displayedMonth==this.startDate.getMonth()){e(".dp-nav-prev-year",this.context).addClass("disabled"),e(".dp-nav-prev-month",this.context).addClass("disabled"),e(".dp-calendar td.other-month",this.context).each(function(){var t=e(this);Number(t.text())>20&&t.addClass("disabled")});var t=this.startDate.getDate();e(".dp-calendar td.current-month",this.context).each(function(){var a=e(this);Number(a.text())<t&&a.addClass("disabled")})}else{if(e(".dp-nav-prev-year",this.context).removeClass("disabled"),e(".dp-nav-prev-month",this.context).removeClass("disabled"),(t=this.startDate.getDate())>20){var a=this.startDate.getTime(),s=new Date(a);s.addMonths(1),this.displayedYear==s.getFullYear()&&this.displayedMonth==s.getMonth()&&e(".dp-calendar td.other-month",this.context).each(function(){var t=e(this);Date.fromString(t.data("datePickerDate")).getTime()<a&&t.addClass("disabled")})}}if(this.displayedYear==this.endDate.getFullYear()&&this.displayedMonth==this.endDate.getMonth()){e(".dp-nav-next-year",this.context).addClass("disabled"),e(".dp-nav-next-month",this.context).addClass("disabled"),e(".dp-calendar td.other-month",this.context).each(function(){var t=e(this);Number(t.text())<14&&t.addClass("disabled")});t=this.endDate.getDate();e(".dp-calendar td.current-month",this.context).each(function(){var a=e(this);Number(a.text())>t&&a.addClass("disabled")})}else{if(e(".dp-nav-next-year",this.context).removeClass("disabled"),e(".dp-nav-next-month",this.context).removeClass("disabled"),(t=this.endDate.getDate())<13){var i=new Date(this.endDate.getTime());i.addMonths(-1),this.displayedYear==i.getFullYear()&&this.displayedMonth==i.getMonth()&&e(".dp-calendar td.other-month",this.context).each(function(){var a=e(this),s=Number(a.text());s<13&&s>t&&a.addClass("disabled")})}}this._applyRenderCallbacks()},_closeCalendar:function(t,a){a&&a!=this.ele||(e(document).unbind("mousedown.datepicker"),e(document).unbind("keydown.datepicker"),this._clearCalendar(),e("#dp-popup a").unbind(),e("#dp-popup").empty().remove(),t||e(this.ele).trigger("dpClosed",[this.getSelected()]))},_clearCalendar:function(){e(".dp-calendar td",this.context).unbind(),e(".dp-calendar",this.context).empty()}}),e.dpConst={SHOW_HEADER_NONE:0,SHOW_HEADER_SHORT:1,SHOW_HEADER_LONG:2,POS_TOP:0,POS_BOTTOM:1,POS_LEFT:0,POS_RIGHT:1,DP_INTERNAL_FOCUS:"dpInternalFocusTrigger"},e.dpText={TEXT_PREV_YEAR:"Previous year",TEXT_PREV_MONTH:"Previous month",TEXT_NEXT_YEAR:"Next year",TEXT_NEXT_MONTH:"Next month",TEXT_CLOSE:"Close",TEXT_CHOOSE_DATE:"Choose date",HEADER_FORMAT:"mmmm yyyy"},e.dpVersion="$Id$",e.fn.datePicker.defaults={month:void 0,year:void 0,showHeader:e.dpConst.SHOW_HEADER_SHORT,startDate:void 0,endDate:void 0,inline:!1,renderCallback:null,createButton:!0,showYearNavigation:!0,closeOnSelect:!0,displayClose:!1,selectMultiple:!1,numSelectable:Number.MAX_VALUE,clickInput:!1,rememberViewedMonth:!0,selectWeek:!1,verticalPosition:e.dpConst.POS_TOP,horizontalPosition:e.dpConst.POS_LEFT,verticalOffset:0,horizontalOffset:0,hoverClass:"dp-hover",autoFocusNextInput:!1},null==e.fn.bgIframe&&(e.fn.bgIframe=function(){return this}),e(window).bind("unload",function(){var t=e.event._dpCache||[];for(var a in t)e(t[a].ele)._dpDestroy()})}(jQuery);