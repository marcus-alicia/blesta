<div class='title_row first'>
    <h3><?php $this->_('CWatch.tab_malware.add_scanner');?></h3>
</div>
<div class="row">
    <div class="col-md-12">
        <?php
        $this->Form->create($this->base_uri . 'clients/serviceTab/' . (isset($service->client_id) ? $service->client_id : null) . '/' . (isset($service->id) ? $service->id : null) . '/tabMalware/', ['id' => 'malware', 'class' => 'disable-on-submit']);
        $this->Form->fieldHidden('actionname', 'addscanner');
        ?>
        <ul>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.domainname', true), 'domainname');
                $this->Form->fieldSelect('domainname', (isset($sites) ? $sites : null), (isset($vars['domainname']) ? $vars['domainname'] : null), ['id' => 'domainname']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.ftpusername', true), 'ftpusername');
                $this->Form->fieldText('username', (isset($vars['username']) ? $vars['username'] : null), ['class' => 'form-control','id' => 'ftpusername']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.ftppassword', true), 'ftppassword');
                $this->Form->fieldPassword('password', ['class' => 'form-control','id' => 'ftppassword', 'value' => (isset($vars['password']) ? $vars['password'] : null)]);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.host', true), 'host');
                $this->Form->fieldText('host', (isset($vars['host']) ? $vars['host'] : null), ['class' => 'form-control','id' => 'host']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.port', true), 'port');
                $this->Form->fieldText('port', (isset($vars['port']) ? $vars['port'] : null), ['class' => 'form-control','id' => 'port']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->fieldCheckbox('sftp', 'true', (isset($vars['sftp']) ? $vars['sftp'] : null) == 'true', ['class' => 'form-control', 'id' => 'sftp']);
                $this->Form->label($this->_('CWatch.tab_malware.sftp', true), 'sftp', ['class' => 'inline']);
                ?>
            </li>
            <li>
                <?php
                $this->Form->label($this->_('CWatch.tab_malware.path', true), 'path');
                $this->Form->fieldText('path', (isset($vars['path']) ? $vars['path'] : null), ['class' => 'form-control','id' => 'path']);
                ?>
            </li>
        </ul>
        <button class="btn btn-default">
            <i class="fas fa-edit"></i> <?php $this->_('CWatch.tab_malware.submit');?>
        </button>
        <?php
        $this->Form->fieldSubmit('test_ftp', $this->_('CWatch.tab_malware.test_credentials', true), ['class' => 'test_ftp btn btn-warning']);
        $this->Form->end();
        ?>
    </div>
    <div class="hide">
        <?php
        foreach ((isset($domains_ftp) ? $domains_ftp : []) as $domain => $domain_ftp) {
        ?>
        <div data-domain="<?php echo $domain;?>" data-login="<?php echo (isset($domain_ftp->login) ? $domain_ftp->login : null);?>" data-host="<?php echo (isset($domain_ftp->host) ? $domain_ftp->host : null);?>" data-port="<?php echo (isset($domain_ftp->port) ? $domain_ftp->port : null);?>" data-path="<?php echo (isset($domain_ftp->path) ? $domain_ftp->path : null);?>"></div>
        <?php
        }
        ?>
    </div>
</div>
<script>
$(document).on('ready', function() {
    $('#domainname').change(function() {
        var ftp = $('div[data-domain="' + $(this).val() + '"]');
        $('#ftpusername').val(ftp.data('login'));
        $('#host').val(ftp.data('host'));
        $('#port').val(ftp.data('port'));
        $('#path').val(ftp.data('path'));
    });
});
</script>
